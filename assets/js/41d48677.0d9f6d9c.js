"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_book=globalThis.webpackChunkphysical_ai_humanoid_robotics_book||[]).push([[702],{3175:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"chapters/weeks-3-5-ros2/ros2-project-walkthrough","title":"ros2-project-walkthrough","description":"---","source":"@site/docs/chapters/02-weeks-3-5-ros2/05-ros2-project-walkthrough.mdx","sourceDirName":"chapters/02-weeks-3-5-ros2","slug":"/chapters/weeks-3-5-ros2/ros2-project-walkthrough","permalink":"/physical-ai-book/docs/chapters/weeks-3-5-ros2/ros2-project-walkthrough","draft":false,"unlisted":false,"editUrl":"https://github.com/zohaibfaiz0/physical-ai-book/docs/chapters/02-weeks-3-5-ros2/05-ros2-project-walkthrough.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"rclpy-agent-bridge","permalink":"/physical-ai-book/docs/chapters/weeks-3-5-ros2/rclpy-agent-bridge"},"next":{"title":"index","permalink":"/physical-ai-book/docs/chapters/weeks-6-7-simulation/"}}');var i=t(4848),s=t(8453),a=t(1523);const r={},c=void 0,l={},d=[{value:"title: &quot;ROS 2 Project Walkthrough: Building a Complete Humanoid Robot System&quot;\ndescription: &quot;Step-by-step guide to creating a complete ROS 2 project for humanoid robot control&quot;\nweek: &quot;Weeks 3\u20135&quot;",id:"title-ros-2-project-walkthrough-building-a-complete-humanoid-robot-systemdescription-step-by-step-guide-to-creating-a-complete-ros-2-project-for-humanoid-robot-controlweek-weeks-35",level:2},{value:"Project Structure and Setup",id:"project-structure-and-setup",level:2},{value:"Core Control System Implementation",id:"core-control-system-implementation",level:2},{value:"Simulation and Testing Environment",id:"simulation-and-testing-environment",level:2},{value:"System Integration and Deployment",id:"system-integration-and-deployment",level:2}];function m(n){const e={code:"code",h1:"h1",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(a.A,{}),"\n",(0,i.jsx)(e.h2,{id:"title-ros-2-project-walkthrough-building-a-complete-humanoid-robot-systemdescription-step-by-step-guide-to-creating-a-complete-ros-2-project-for-humanoid-robot-controlweek-weeks-35",children:'title: "ROS 2 Project Walkthrough: Building a Complete Humanoid Robot System"\ndescription: "Step-by-step guide to creating a complete ROS 2 project for humanoid robot control"\nweek: "Weeks 3\u20135"'}),"\n",(0,i.jsx)(e.h1,{id:"ros-2-project-walkthrough-building-a-complete-humanoid-robot-system",children:"ROS 2 Project Walkthrough: Building a Complete Humanoid Robot System"}),"\n",(0,i.jsx)(e.h2,{id:"project-structure-and-setup",children:"Project Structure and Setup"}),"\n",(0,i.jsx)(e.p,{children:"Creating a complete ROS 2 project for humanoid robot control begins with establishing the proper project structure and development environment. The recommended structure follows ROS 2 conventions while accommodating the complexity of humanoid systems. The project begins with creating a workspace directory and organizing packages according to their functionality: perception, control, simulation, and utility packages."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Create workspace\nmkdir -p ~/ros2_humanoid_ws/src\ncd ~/ros2_humanoid_ws\n\n# Create package structure\nmkdir -p src/humanoid_bringup\nmkdir -p src/humanoid_control\nmkdir -p src/humanoid_perception\nmkdir -p src/humanoid_simulation\nmkdir -p src/humanoid_msgs\n"})}),"\n",(0,i.jsx)(e.p,{children:"The project requires ROS 2 Humble Hawksbill (or Iron/Iron/Jazzy for 2025), which provides the necessary stability and features for humanoid robot development. Install ROS 2 and essential dependencies:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# Install ROS 2 Humble (Ubuntu 22.04)\nsudo apt update\nsudo apt install software-properties-common\nsudo add-apt-repository universe\nsudo apt update\nsudo apt install ros-humble-desktop\nsudo apt install python3-rosdep python3-rosinstall python3-rosinstall-generator python3-wstool build-essential\n\n# Initialize rosdep\nsudo rosdep init\nrosdep update\n\n# Source ROS 2 environment\nsource /opt/ros/humble/setup.bash\necho "source /opt/ros/humble/setup.bash" >> ~/.bashrc\n'})}),"\n",(0,i.jsx)(e.p,{children:"The humanoid_msgs package contains custom message and service definitions that facilitate communication between different system components. Create the package with appropriate dependencies:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'cd ~/ros2_humanoid_ws/src\nros2 pkg create --dependencies std_msgs builtin_interfaces --maintainer-email "developer@panaversity.com" --maintainer-name "Panaversity Developer" --license "Apache-2.0" humanoid_msgs\n'})}),"\n",(0,i.jsx)(e.p,{children:"Within humanoid_msgs, create the necessary message definitions for humanoid-specific data types:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# Create message directories\nmkdir -p humanoid_msgs/msg\nmkdir -p humanoid_msgs/srv\n\n# Create humanoid joint state message\ncat > humanoid_msgs/msg/HumanoidJointState.msg << EOF\n# Custom message for humanoid joint states\nstring[] name\nfloat64[] position\nfloat64[] velocity\nfloat64[] effort\nstring[] limb_names  # e.g., "left_arm", "right_leg", etc.\nuint8[] limb_types   # 0=arm, 1=leg, 2=head\nEOF\n\n# Create humanoid pose message\ncat > humanoid_msgs/msg/HumanoidPose.msg << EOF\n# Custom message for humanoid pose\nbuiltin_interfaces/Time timestamp\ngeometry_msgs/Pose torso_pose\ngeometry_msgs/Pose[] limb_poses\nfloat64 center_of_mass_x\nfloat64 center_of_mass_y\nfloat64 center_of_mass_z\nuint8[] support_polygon  # indices of feet in support\nEOF\n'})}),"\n",(0,i.jsx)(e.p,{children:"Update the package.xml to include the message generation dependencies:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>humanoid_msgs</name>\n  <version>0.0.0</version>\n  <description>Custom messages for humanoid robot control</description>\n  <maintainer email="developer@panaversity.com">Panaversity Developer</maintainer>\n  <license>Apache-2.0</license>\n\n  <buildtool_depend>ament_cmake</buildtool_depend>\n  <build_depend>rosidl_default_generators</build_depend>\n  <exec_depend>rosidl_default_runtime</exec_depend>\n  <member_of_group>rosidl_interface_packages</member_of_group>\n\n  <depend>std_msgs</depend>\n  <depend>geometry_msgs</depend>\n  <depend>builtin_interfaces</depend>\n\n  <test_depend>ament_lint_auto</test_depend>\n  <test_depend>ament_lint_common</test_depend>\n\n  <export>\n    <build_type>ament_cmake</build_type>\n  </export>\n</package>\n'})}),"\n",(0,i.jsx)(e.p,{children:"And update the CMakeLists.txt to include message generation:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cmake",children:'cmake_minimum_required(VERSION 3.8)\nproject(humanoid_msgs)\n\nif(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")\n  add_compile_options(-Wall -Wextra -Wpedantic)\nendif()\n\n# Find dependencies\nfind_package(ament_cmake REQUIRED)\nfind_package(rosidl_default_generators REQUIRED)\nfind_package(std_msgs REQUIRED)\nfind_package(geometry_msgs REQUIRED)\nfind_package(builtin_interfaces REQUIRED)\n\n# Generate messages\nset(msg_files\n  "msg/HumanoidJointState.msg"\n  "msg/HumanoidPose.msg"\n)\n\nrosidl_generate_interfaces(${PROJECT_NAME}\n  ${msg_files}\n  DEPENDENCIES std_msgs geometry_msgs builtin_interfaces\n  ADD_LINTER_TESTS\n)\n\nament_package()\n'})}),"\n",(0,i.jsx)(e.h2,{id:"core-control-system-implementation",children:"Core Control System Implementation"}),"\n",(0,i.jsx)(e.p,{children:"The humanoid_control package implements the core control algorithms for the humanoid robot, including joint control, balance control, and trajectory generation. This package serves as the central hub for all control-related functionality."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'cd ~/ros2_humanoid_ws/src\nros2 pkg create --dependencies rclcpp rclpy std_msgs sensor_msgs geometry_msgs humanoid_msgs --maintainer-email "developer@panaversity.com" --maintainer-name "Panaversity Developer" --license "Apache-2.0" humanoid_control\n'})}),"\n",(0,i.jsx)(e.p,{children:"Create the main controller node in C++:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cpp",children:'// humanoid_control/src/humanoid_controller.cpp\n#include <rclcpp/rclcpp.hpp>\n#include <sensor_msgs/msg/joint_state.hpp>\n#include <humanoid_msgs/msg/humanoid_joint_state.hpp>\n#include <std_msgs/msg/float64_multi_array.hpp>\n#include <vector>\n#include <map>\n#include <memory>\n\nclass HumanoidController : public rclcpp::Node\n{\npublic:\n    HumanoidController() : Node("humanoid_controller")\n    {\n        // Create publishers\n        joint_command_publisher_ = this->create_publisher<std_msgs::msg::Float64MultiArray>(\n            "/joint_group_position_controller/commands", 10);\n\n        // Create subscribers\n        joint_state_subscriber_ = this->create_subscription<sensor_msgs::msg::JointState>(\n            "/joint_states", 10,\n            std::bind(&HumanoidController::joint_state_callback, this, std::placeholders::_1));\n\n        humanoid_state_subscriber_ = this->create_subscription<humanoid_msgs::msg::HumanoidJointState>(\n            "/humanoid_joint_states", 10,\n            std::bind(&HumanoidController::humanoid_state_callback, this, std::placeholders::_1));\n\n        // Create timer for control loop\n        control_timer_ = this->create_wall_timer(\n            std::chrono::milliseconds(10), // 100 Hz control loop\n            std::bind(&HumanoidController::control_loop, this));\n\n        RCLCPP_INFO(this->get_logger(), "Humanoid Controller initialized");\n    }\n\nprivate:\n    void joint_state_callback(const sensor_msgs::msg::JointState::SharedPtr msg)\n    {\n        // Store current joint states\n        current_joint_positions_ = msg->position;\n        current_joint_velocities_ = msg->velocity;\n        current_joint_names_ = msg->name;\n    }\n\n    void humanoid_state_callback(const humanoid_msgs::msg::HumanoidJointState::SharedPtr msg)\n    {\n        // Process humanoid-specific joint state\n        humanoid_joint_names_ = msg->name;\n        humanoid_joint_positions_ = msg->position;\n        humanoid_limb_names_ = msg->limb_names;\n    }\n\n    void control_loop()\n    {\n        // Main control algorithm\n        std_msgs::msg::Float64MultiArray command_msg;\n\n        // Generate control commands based on current state\n        std::vector<double> commands = generate_control_commands();\n\n        command_msg.data = commands;\n\n        // Publish control commands\n        joint_command_publisher_->publish(command_msg);\n    }\n\n    std::vector<double> generate_control_commands()\n    {\n        // Implement control algorithm\n        // This is a simplified example - real implementation would include\n        // inverse kinematics, balance control, trajectory planning, etc.\n\n        std::vector<double> commands;\n\n        // Example: simple position control\n        for (size_t i = 0; i < current_joint_positions_.size(); ++i) {\n            // Implement PD control or more sophisticated control\n            double target_pos = current_joint_positions_[i] + 0.01; // Simple increment\n            commands.push_back(target_pos);\n        }\n\n        return commands;\n    }\n\n    // Publishers\n    rclcpp::Publisher<std_msgs::msg::Float64MultiArray>::SharedPtr joint_command_publisher_;\n\n    // Subscribers\n    rclcpp::Subscription<sensor_msgs::msg::JointState>::SharedPtr joint_state_subscriber_;\n    rclcpp::Subscription<humanoid_msgs::msg::HumanoidJointState>::SharedPtr humanoid_state_subscriber_;\n\n    // Timer\n    rclcpp::TimerBase::SharedPtr control_timer_;\n\n    // Internal state\n    std::vector<double> current_joint_positions_;\n    std::vector<double> current_joint_velocities_;\n    std::vector<std::string> current_joint_names_;\n\n    std::vector<double> humanoid_joint_positions_;\n    std::vector<std::string> humanoid_joint_names_;\n    std::vector<std::string> humanoid_limb_names_;\n};\n\nint main(int argc, char * argv[])\n{\n    rclcpp::init(argc, argv);\n    rclcpp::spin(std::make_shared<HumanoidController>());\n    rclcpp::shutdown();\n    return 0;\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"Update the CMakeLists.txt for the controller package:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-cmake",children:'cmake_minimum_required(VERSION 3.8)\nproject(humanoid_control)\n\nif(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES "Clang")\n  add_compile_options(-Wall -Wextra -Wpedantic)\nendif()\n\n# Find dependencies\nfind_package(ament_cmake REQUIRED)\nfind_package(rclcpp REQUIRED)\nfind_package(rclpy REQUIRED)\nfind_package(std_msgs REQUIRED)\nfind_package(sensor_msgs REQUIRED)\nfind_package(geometry_msgs REQUIRED)\nfind_package(humanoid_msgs REQUIRED)\n\n# Add executable\nadd_executable(humanoid_controller src/humanoid_controller.cpp)\nament_target_dependencies(humanoid_controller\n  rclcpp std_msgs sensor_msgs geometry_msgs humanoid_msgs)\n\n# Install targets\ninstall(TARGETS\n  humanoid_controller\n  DESTINATION lib/${PROJECT_NAME})\n\nament_package()\n'})}),"\n",(0,i.jsx)(e.h2,{id:"simulation-and-testing-environment",children:"Simulation and Testing Environment"}),"\n",(0,i.jsx)(e.p,{children:"The simulation environment provides a safe and controlled space for testing humanoid robot algorithms before deployment on physical hardware. Using Gazebo with ROS 2, we can create realistic simulation scenarios that closely match real-world conditions."}),"\n",(0,i.jsx)(e.p,{children:"Create the simulation package:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'cd ~/ros2_humanoid_ws/src\nros2 pkg create --dependencies rclcpp rclpy gazebo_ros_pkgs robot_state_publisher joint_state_publisher --maintainer-email "developer@panaversity.com" --maintainer-name "Panaversity Developer" --license "Apache-2.0" humanoid_simulation\n'})}),"\n",(0,i.jsx)(e.p,{children:"Create a launch file to start the simulation:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"# humanoid_simulation/launch/humanoid_sim.launch.py\nfrom launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, IncludeLaunchDescription\nfrom launch.conditions import IfCondition\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node\nfrom launch_ros.substitutions import FindPackageShare\n\ndef generate_launch_description():\n    # Launch configuration variables\n    use_sim_time = LaunchConfiguration('use_sim_time')\n    robot_model = LaunchConfiguration('robot_model', default='simple_humanoid')\n\n    # Declare launch arguments\n    declare_use_sim_time = DeclareLaunchArgument(\n        'use_sim_time',\n        default_value='true',\n        description='Use simulation clock if true'\n    )\n\n    declare_robot_model = DeclareLaunchArgument(\n        'robot_model',\n        default_value='simple_humanoid',\n        description='Robot model to load'\n    )\n\n    # Robot State Publisher\n    robot_description_path = PathJoinSubstitution([\n        FindPackageShare('humanoid_simulation'),\n        'urdf',\n        LaunchConfiguration('robot_model')\n    ])\n\n    robot_state_publisher = Node(\n        package='robot_state_publisher',\n        executable='robot_state_publisher',\n        name='robot_state_publisher',\n        parameters=[{\n            'use_sim_time': use_sim_time,\n            'robot_description': robot_description_path\n        }],\n        output='screen'\n    )\n\n    # Gazebo launch\n    gazebo = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource([\n            PathJoinSubstitution([\n                FindPackageShare('gazebo_ros'),\n                'launch',\n                'gazebo.launch.py'\n            ])\n        ]),\n    )\n\n    # Joint State Publisher (for GUI control)\n    joint_state_publisher = Node(\n        package='joint_state_publisher',\n        executable='joint_state_publisher',\n        name='joint_state_publisher',\n        parameters=[{'use_sim_time': use_sim_time}],\n        output='screen'\n    )\n\n    # Joint State Publisher GUI\n    joint_state_publisher_gui = Node(\n        package='joint_state_publisher_gui',\n        executable='joint_state_publisher_gui',\n        name='joint_state_publisher_gui',\n        parameters=[{'use_sim_time': use_sim_time}],\n        output='screen'\n    )\n\n    # RViz for visualization\n    rviz_config = PathJoinSubstitution([\n        FindPackageShare('humanoid_simulation'),\n        'rviz',\n        'humanoid_sim.rviz'\n    ])\n\n    rviz_node = Node(\n        package='rviz2',\n        executable='rviz2',\n        name='rviz2',\n        arguments=['-d', rviz_config],\n        parameters=[{'use_sim_time': use_sim_time}],\n        output='screen'\n    )\n\n    # Return launch description\n    ld = LaunchDescription()\n\n    # Add launch arguments\n    ld.add_action(declare_use_sim_time)\n    ld.add_action(declare_robot_model)\n\n    # Add nodes\n    ld.add_action(robot_state_publisher)\n    ld.add_action(gazebo)\n    ld.add_action(joint_state_publisher)\n    ld.add_action(joint_state_publisher_gui)\n    ld.add_action(rviz_node)\n\n    return ld\n"})}),"\n",(0,i.jsx)(e.h2,{id:"system-integration-and-deployment",children:"System Integration and Deployment"}),"\n",(0,i.jsx)(e.p,{children:"The final step involves integrating all components and creating launch files for complete system deployment. The humanoid_bringup package coordinates the startup of all necessary nodes for the complete humanoid system."}),"\n",(0,i.jsx)(e.p,{children:"Create the bringup package:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'cd ~/ros2_humanoid_ws/src\nros2 pkg create --dependencies rclpy launch ros2launch --maintainer-email "developer@panaversity.com" --maintainer-name "Panaversity Developer" --license "Apache-2.0" humanoid_bringup\n'})}),"\n",(0,i.jsx)(e.p,{children:"Create the main system launch file:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"# humanoid_bringup/launch/humanoid_system.launch.py\nfrom launch import LaunchDescription\nfrom launch.actions import IncludeLaunchDescription, DeclareLaunchArgument\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.substitutions import FindPackageShare\n\ndef generate_launch_description():\n    # Launch configuration variables\n    use_sim_time = LaunchConfiguration('use_sim_time', default='false')\n    robot_model = LaunchConfiguration('robot_model', default='simple_humanoid')\n\n    # Include all system components\n    perception_launch = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource([\n            PathJoinSubstitution([\n                FindPackageShare('humanoid_perception'),\n                'launch',\n                'perception.launch.py'\n            ])\n        ]),\n        launch_arguments={\n            'use_sim_time': use_sim_time\n        }.items()\n    )\n\n    control_launch = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource([\n            PathJoinSubstitution([\n                FindPackageShare('humanoid_control'),\n                'launch',\n                'control.launch.py'\n            ])\n        ]),\n        launch_arguments={\n            'use_sim_time': use_sim_time\n        }.items()\n    )\n\n    # Create launch description\n    ld = LaunchDescription()\n\n    # Add launch arguments\n    ld.add_action(DeclareLaunchArgument(\n        'use_sim_time',\n        default_value='false',\n        description='Use simulation clock if true'\n    ))\n\n    # Add system components\n    ld.add_action(perception_launch)\n    ld.add_action(control_launch)\n\n    return ld\n"})}),"\n",(0,i.jsx)(e.p,{children:"Build the workspace:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"cd ~/ros2_humanoid_ws\nsource /opt/ros/humble/setup.bash\ncolcon build --packages-select humanoid_msgs humanoid_control humanoid_simulation humanoid_bringup\nsource install/setup.bash\n"})}),"\n",(0,i.jsx)(e.p,{children:"The complete system is now ready for testing. Launch the simulation:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"ros2 launch humanoid_simulation humanoid_sim.launch.py\n"})}),"\n",(0,i.jsx)(e.p,{children:"Then in another terminal, launch the control system:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"ros2 launch humanoid_control humanoid_control.launch.py\n"})}),"\n",(0,i.jsx)(e.p,{children:"This walkthrough demonstrates the complete process of creating a ROS 2 project for humanoid robot control, from initial setup through system integration and deployment. The modular architecture allows for easy extension and modification of individual components while maintaining system integrity."})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(m,{...n})}):m(n)}}}]);